<html ng-app="OtherwiseTest">
  <head>
      <title>Otherwise Testcase - LAB e2e tests</title>

      <link rel="stylesheet" type="text/css" href="../../components/lungo/lungo.css"/>
      <!-- <link rel="stylesheet" type="text/css" href="../../test/lib/lungo.slow-transitions.css"/> -->
      <link rel="stylesheet" type="text/css" href="../../components/lungo/lungo.icon.css"/>
      <link rel="stylesheet" type="text/css" href="../../components/lungo/theme.lungo.css">
      <script type="text/javascript" src="../../components/quojs/quo.debug.js"></script>
      <script type="text/javascript" src="../../lib/lungo.debug.js"></script>

      <script type="text/ng-template" id="splash.html">
        <section id="splash" data-transition="slide">
          <header>
            <span class="title center">Splash!</span>
          </header>
          <article class="active">
            <strong>Splash screen</strong>
            <p>This should auto-redirect you to login after {{redirectTimeout/1000}} seconds; so far: {{timeToRedirect}}ms has passed</p>
            <p>If you're bored, click this browser-handled link: <a href="#/login">go to login</a></p>
            <p>If you're bored click this Angular-handled link: <a ng-click="goToLogin()">go to login</a></p>
          </active>
        </section>
      </script>

      <script type="text/ng-template" id="login.html">
        <section id="login" data-transition="slide">
          <header>
            <span class="title center">Login!</span>
          </header>
          <article class="active">
            <strong>Please login</strong>
            <button>Magic login button</button>
          </active>
        </section>
      </script>

      <script type="text/ng-template" id="app.html">
        <section id="app" data-transition="slide">
          <header>
            <span class="title center">The app</span>
          </header>
          <article class="active">
            <strong>You are logged in!</strong>
            <p><a href="#/">Now log out, ok?</a></p>
          </active>
        </section>
      </script>


  </head>

  <body lab-boot>
    <section id="main" data-transition="slide">
      <article class="active" id="first_article">
        <strong>Start page</strong>
        <p>This should never be displayed</p>
      </article>
    </section>

    <lab-view></lab-view>

    <script type="text/javascript" src="../../components/angular/angular.js"></script>
    <script type="text/javascript" src="../../src/lungo-angular-bridge.js"></script>

    <script>
      // Declare app level module which depends on filters, and services
      angular.module('OtherwiseTest', 
        ['Centralway.lungo-angular-bridge']).
        config(['$routeProvider', '$locationProvider', function($routeProvider, $locationProvider) {

          $routeProvider.when('/splash', {templateUrl: 'splash.html', controller: SplashCtrl});
          $routeProvider.when('/login', {templateUrl: 'login.html'});
          $routeProvider.when('/app', {templateUrl: 'app.html'});

          $routeProvider.otherwise({redirectTo: '/splash'});
          $locationProvider.html5Mode(false);
        }]);

      function SplashCtrl($scope, $location) {
        console.log('SplashCtrl - Instantiated');

        var timeoutId = null;

        $scope.goToLogin = function() {
          clearTimeout(timeoutId);
          $location.path('/login');
        }

        $scope.timeToRedirect = 0;
        $scope.redirectIncrement = 500;
        $scope.redirectTimeout = 3000;

        var countDown = function() {
          $scope.$apply(function() {

            if($scope.timeToRedirect >= $scope.redirectTimeout) {
              console.log('SplashCtrl::countDown() - Redirecting to login!');
              $location.path('/login');
            }
            else {
              console.log('SplashCtrl::countDown() - countdown at ', $scope.timeToRedirect);
              $scope.timeToRedirect+= $scope.redirectIncrement;
              timeoutId = setTimeout(countDown, $scope.redirectIncrement);
            }
          });
        };

        timeoutId = setTimeout(countDown, $scope.redirectIncrement);
      }
    </script>
  </body>
</html> 











